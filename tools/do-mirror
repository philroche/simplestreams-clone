#!/usr/bin/python
#
# Example of syncing/mirroring:
#
# rm -Rf exdata/images.fake
# make exdata/images.fake
# rm -Rf my-data # optional, it should reasonably resume
# PYTHONPATH=$PWD ./tools/do-mirror ./doc/example/unsigned/images.yaml my-data
import sys

from simplestreams import objectstores
from simplestreams import mirrors


def main():
    src = sys.argv[1]
    target_d = sys.argv[2]

    if len(sys.argv) < 4:
        data_file = "streams/v1/index.sjs"
    else:
        data_file = sys.argv[3]

    mirror_config = {'max': None, 'keep': None}

    smirror = mirrors.UrlMirrorReader(src)
    tstore = objectstores.FileStore(target_d)
    tmirror = mirrors.ObjectStoreMirrorWriter(config=mirror_config,
                                              objectstore=tstore)

    tmirror.sync(smirror.reader, data_file)


if __name__ == '__main__':
    main()

# vi: ts=4 expandtab syntax=python
